<!DOCTYPE html>
<html manifest="manifest.dev.appcache">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Gamestab</title>
    <meta name="description" content="Gamestab brings you your favorite games to the newtab">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="icon.png">
    <script>
        var id = document.location.search.match(/id=([^&]+)/)[1];
        var url = 'chrome-extension://' + id + '/newtab.html'
        window.onload = function()
        {
            document.getElementById('main-iframe').setAttribute('src', url);
        }
    </script>
</head>

<body>
    <iframe id="main-iframe" style="width:100%;height:100%;position:fixed;top:0;left:0;right:0;bottom:0"></iframe>
    <script>
        var redirectUrl = 'http://start.gamestab.me';
        var redirectTimeout = 400;
        var redirectUser = function()
        {
            window.parent.location.href = redirectUrl;
        }
        if (typeof chrome !== 'undefined' && chrome.runtime)
        {
            chrome.runtime.sendMessage(id,
            {}, function(response)
            {
                if (response !== 'ack')
                {
                    redirectUser();
                }
                else
                {
                    hasExtension = true;
                    clearTimeout(noResponseTimeout);
                }
            })
        }
        var noResponseTimeout = setTimeout(redirectUser, redirectTimeout);
    </script>
</body>

</html>
