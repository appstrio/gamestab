"use strict";function Analytics(a){var b=this;b.setup=a,b.cc=a.setup.location.country.short_name,b.t1=["us","ca","uk","gb"],b.t2=["fr","de","au","at","be","dk","fi","is","ie","lu","nl","nz","no","ch","se"],b.t3=["ar","br","bg","ba","cl","hr","cy","cz","ee","ge","gr","hk","hu","it","jp","il","lt","ro","sk","sl","es","tr"],b.sEventValue={t1:4,t2:2,t3:.8,t4:.2},b.googleAnalyticsUid=MY_CONFIG.config.google_analytics_uid,b.init()}function ChromeApps(a){var b=this;chrome.management.getAll(function(c){c=c||[],b.apps=_.reject(c,function(a){return!a.isApp}),_.each(b.apps,function(a){a.icon=a.icons.last().url}),(a||common.noop)()})}function ClassicLauncher(a,b,c){var d=this;d.renderer=a,d.chromeApps=b,d.topsites=c,d.$dialsWrapper=this.renderer.$$wrapper.find(".dials-wrapper").eq(0),d.$appsWrapper=this.renderer.$$wrapper.find(".apps-wrapper").eq(0),d.$appsSwitch=this.renderer.$$wrapper.find(".apps-switch").eq(0),d.$dialsSwitch=this.renderer.$$wrapper.find(".dials-switch").eq(0)}function Config(){this.key="config",this.storage=new MyStorage}function FileSystem(a){var b=this;try{window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var c=10485760,d=window.PERSISTENT,e={persistent:"webkitPersistentStorage",temporary:"temporaryStorage"};navigator[e.persistent].requestQuota(c,function(c){window.requestFileSystem(d,c,function(c){b.fs=c,b.fsReady=!0,(a||common.noop)(null)},function(c){(a||common.noop)(c),b.errorHandler.apply(arguments)})},function(){})}catch(f){}}function Geo(){var a=this;a.gMapsBaseUrl="https://maps.googleapis.com/maps/api/geocode/json?sensor=false&latlng="}function Launcher(a,b,c){var d=this;d.renderer=a,d.chromeApps=b,d.topsites=c}function News(a,b,c){var d=this;d.renderer=a,d.weather=b,d.setup=c,d.baseUrl="http://news.google.com?ned=",d.key="news",d.storage=new MyStorage,d.countriesNEDS={il:"iw_il",ar:"es_ar",au:"au",us:"us",be:"nl_be",br:"pt-BR_br",pt:"pt-PT_pt"}}function Renderer(a){var b=this;b.$wrapper=$("#wrapper"),b.config=MY_CONFIG.config,b.setup=a,MY_CONFIG.config.classic_layout?(b.$$wrapper=$(templates.classic()),b.$$searchWrapper=b.$$wrapper.find(".search-wrapper").eq(0)):(b.$$wrapper=$(templates.wrapper({})),b.$$searchWrapper=b.$$wrapper.find(".search-wrapper").eq(0),b.$$launcherWrapper=b.$$wrapper.find(".launcher-wrapper").eq(0),b.$$newsWrapper=b.$$wrapper.find(".news-wrapper").eq(0),b.$$weatherWrapper=b.$$wrapper.find(".weather-wrapper").eq(0),b.$$titleWrapper=b.$$wrapper.find(".title-wrapper").eq(0)),b.clockInterval=null}function Screenshot(a,b){var c=this;c.storage=new MyStorage,c.key="screenshots",c.useCaptureQueue=!0,c.closeWindowTimeoutScript={file:"/js/content_scripts/capture.js",runAt:"document_start"},c.fs=a,c.storage.get(c.key,function(a){c.screenshots=a||[],(b||common.noop)()})}function Search(a,b){var c=this,d=MY_CONFIG.config;c.setup=b,c.cc=c.setup.setup.location.country.short_name,c.renderer=a,c.base_search_url=d.base_search_url,c.base_suggestions_url=d.base_suggestions_url}function Setup(a){var b=this;b.geo=new Geo,b.key="setup",b.storage=new MyStorage,b.superfishCCS=["US","CA","UK","DE","FR","AU","NZ","SE","CH","NO","NL","BE","AT","FL","IS","IE","LU","IE","ES","IT","BR","AR","IL"],b.storage.get(b.key,function(c){c[b.key]?(b.setup=c[b.key],b.checkBoosterEnabled(),b.setup.location?(a||common.noop)(null,b.setup):b.getLocation(function(c){b.setup.location=c,b.store(),(a||common.noop)(null,b.setup)})):b.run(a)})}function MyStorage(){this.initLocalStorage()}function Topsites(a,b){var c=this;c.maximumDiasAmount=8,c.key="topsites",c.ignoreListKey="ignoreList",c.storage=new MyStorage,c.screenshot=a,c.getIgnoreList(function(a,d){c.ignoreList=d||[],c.get(function(a,d){a?c.getFromChrome(function(a){c.topsites=c.removeIgnored(a,c.ignoreList),c.topsites=c.topsites.slice(0,c.maximumDiasAmount),c.fillScreenshots(c.topsites),(b||common.noop)()}):(c.topsites=c.removeIgnored(d,c.ignoreList),c.fillScreenshots(c.topsites),(b||common.noop)())})})}function Weather(a,b){var c=this;c.renderer=a,c.setup=b,c.storage=new MyStorage,c.key="weather",c.baseURL="http://api.openweathermap.org/data/2.5/forecast/daily?mode=json",c.weekday=new Array(7),c.weekday[0]="Sunday",c.weekday[1]="Monday",c.weekday[2]="Tuesday",c.weekday[3]="Wednesday",c.weekday[4]="Thursday",c.weekday[5]="Friday",c.weekday[6]="Saturday",c.oldPeriod=108e5,c.unitsByCountry={us:"imperial",uk:"imperial",ca:"imperial",nz:"imperial",ir:"imperial","in":"imperial"}}window._gaq=window._gaq||[],Analytics.prototype.sendEvent=function(a,b){var c=this;if(!a.category||!a.action)return(b||angular.noop)();var d=a.category,e=a.action,f=a.label||"",g=a.value,h=a.opt_noninteraction||!1,i=["_trackEvent",d,e,f,g,h];return c.push(i,b)},Analytics.prototype.sendCustomVar=function(a,b){if("undefined"==typeof a.index||!a.name||"undefined"==typeof a.value)return!1;if(a.index<1||a.index>5)return!1;if(a.opt_scope=a.opt_scope||3,a.opt_scope<1||a.opt_scope>3)return!1;var c=["_setCustomVar",a.index,a.name,a.value.toString(),a.opt_scope];return self.push(c,b)},Analytics.prototype.push=function(a,b){_gaq.push(a),b&&_gaq.push(function(){(b||common.noop)()})},Analytics.prototype.init=function(){var a=this;a.push(["_setAccount",a.googleAnalyticsUid]),a.push(["_trackPageview"]),MY_CONFIG.config.ab_testing_group&&a.push(["_setCustomVar",1,"AB_TESTING",MY_CONFIG.config.ab_testing_group,1]),MY_CONFIG.config.install_week_number&&a.push(["_setCustomVar",2,"INSTALL_WEEK_NUMBER",MY_CONFIG.config.install_week_number,1]),MY_CONFIG.config.client_version&&a.push(["_setCustomVar",4,"CLIENT_VERSION",MY_CONFIG.config.client_version,1]),MY_CONFIG.config.superfish_enabled&&a.push(["_setCustomVar",5,"IS_SUPERFISH_COUNTRY",MY_CONFIG.config.superfish_enabled?!0:!1,1]),document.URL.indexOf("#newtab")>-1&&a.sendEvent({category:"Pageload",action:"with booster",label:"with booster"}),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()},Analytics.prototype.getEventValue=function(a){var b=this;if(!a)return b.sEventValue.t4;var c="t4";return b.t3.indexOf(a)>=0&&(c="t3"),b.t2.indexOf(a)>=0&&(c="t2"),b.t1.indexOf(a)>=0&&(c="t1"),b.sEventValue[c]},ClassicLauncher.prototype.render=function(){var a=this;_.each(a.topsites.topsites,function(b){a.renderDial(b)}),_.each(a.chromeApps.apps,function(b){a.renderApp(b)}),a.setEventHandlers()},ClassicLauncher.prototype.renderDial=function(a){var b=this,c=$(templates["classic-dial"](a));c.data("dial",a),b.$dialsWrapper.append(c),a.screenshotDefer&&a.screenshotDefer.promise&&a.screenshotDefer.promise().done(function(){c.find(".thumbnail-wrapper").css("background-image","url("+a.screenshot+")")})},ClassicLauncher.prototype.renderApp=function(a){var b=this,c=$(templates["classic-app"](a));c.data("app",a),b.$appsWrapper.append(c)},ClassicLauncher.prototype.setEventHandlers=function(){var a=this;a.renderer.$$wrapper.on("click",".dial",_.bind(a.dialClickHandler,a)),a.renderer.$$wrapper.on("click",".dial-remove-button",_.bind(a.dialRemoveClickHandler,a)),a.renderer.$$wrapper.on("click",".app",_.bind(a.appClickHandler,a)),a.renderer.$$wrapper.on("click",".app-remove-button",_.bind(a.appRemoveClickHandler,a)),a.renderer.$$wrapper.on("click",".apps-switch",_.bind(a.appsSwitchClickHandler,a)),a.renderer.$$wrapper.on("click",".dials-switch",_.bind(a.dialsSwitchClickHandler,a))},ClassicLauncher.prototype.dialClickHandler=function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.data("url");window.analytics&&window.analytics.sendEvent({category:"Dials",action:"Click",label:c},function(){window.location.href=c}),setTimeout(function(){window.location.href=c},500)},ClassicLauncher.prototype.dialRemoveClickHandler=function(a){var b=this;a.stopPropagation(),a.preventDefault();var c=$(a.currentTarget).parents(".dial").eq(0);c.fadeOut(function(){b.topsites.getAndAddNewDial(function(a,c){c&&_.defer(function(){b.renderDial(c)})})}),b.topsites.addToIgnored(c.data("url"))},ClassicLauncher.prototype.appClickHandler=function(a){a.stopPropagation(),a.preventDefault();var b=$(a.currentTarget),c=b.data("id");chrome.management.launchApp(c,function(){})},ClassicLauncher.prototype.appRemoveClickHandler=function(a){a.stopPropagation(),a.preventDefault();var b=$(a.currentTarget).parents(".app").eq(0),c=b.data("id");chrome.management.uninstall(c,{showConfirmDialog:!0},function(){chrome.management.getAll(function(a){a=a||[];var d=_.findWhere(a,{id:c});d||b.fadeOut()})})},ClassicLauncher.prototype.appsSwitchClickHandler=function(a){var b=this;a.stopPropagation(),a.preventDefault(),b.$appsSwitch.addClass("selected"),b.$dialsSwitch.removeClass("selected"),b.$dialsWrapper.hide(),b.$appsWrapper.show()},ClassicLauncher.prototype.dialsSwitchClickHandler=function(a){var b=this;a.stopPropagation(),a.preventDefault(),b.$appsSwitch.removeClass("selected"),b.$dialsSwitch.addClass("selected"),b.$dialsWrapper.show(),b.$appsWrapper.hide()},ClassicLauncher.prototype.wrapperClickHandler=function(a){var b=this;a.stopPropagation(),console.log("self.renderer.$$wrapper",b.renderer.$$wrapper),b.renderer.$wrapper.toggleClass("launcher-maximized")},Config.prototype.init=function(a){var b=this;this.loadFromStorage(function(c,d){d?(b.config=d,b.setDefaults(d),b.setClientVersion(),(a||common.noop)(d)):b.loadFromFile(function(c,d){d&&(b.config=d,b.setClientVersion(),(a||common.noop)(d))})})},Config.prototype.loadFromStorage=function(a){var b=this;this.storage.get(this.key,function(c){(a||b.noop)(null,c[b.key])})},Config.prototype.loadFromFile=function(a){var b=ENV.toLowerCase(),c=this;$.getJSON("/"+b+".json",function(b){if(console.log("result",b),b.config){b.config.timestamp=Date.now();var d=b.config.build_options,e=_.extend(d,b.config);delete e.build_options;var f=_.extend({},e);f.build_options=d,console.log("real_config",f),c.setDefaults(f,function(){(a||this.noop)(null,f)})}else(a||this.noop)("Config file is empty")},function(b){(a||this.noop)(b)})},Config.prototype.setDefaults=function(a,b){var c;a.timestamp||(a.timestamp=Date.now(),c=!0),a.ab_testing_group||(a.ab_testing_group=Math.random()>.5?"A":"B",c=!0),a.install_week_number||(a.install_week_number=(new Date).getWeek(),c=!0),c?this.storeConfigObject(a,b):(b||common.noop)()},Config.prototype.setClientVersion=function(){this.config.client_version=chrome&&chrome.app&&chrome.app.getDetails()?chrome.app.getDetails().version:""},Config.prototype.storeConfigObject=function(a,b){a=a||this.config;var c={};c[this.key]=_.extend({},a),this.storage.set(c,b)},FileSystem.prototype.errorHandler=function(){var a="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:a="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:a="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:a="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:a="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:a="INVALID_STATE_ERR";break;default:a="Unknown Error"}console.error("FileSystem Error: "+a)},FileSystem.prototype.write=function(a,b,c,d){var e=this;try{e.fs.root.getFile(a,{create:!0},function(a){a.createWriter(function(e){if(e.onwriteend=function(){(d||common.noop)(null,a.toURL())},e.onerror=function(){(d||common.noop)("err")},"image/jpeg"==b||"image/png"==b){var f=atob(c),g=f.length;c=new ArrayBuffer(g);for(var h=new Uint8Array(c),i=0;g>i;i++)h[i]=f.charCodeAt(i)}var j=new Blob([c],{type:b});e.write(j)},e.errorHandler)},e.errorHandler)}catch(f){console.error("Error write",f)}},FileSystem.prototype.read=function(a,b){try{self.fs.root.getFile(a,{},function(a){a.file(function(a){var c=new FileReader;c.onloadend=function(){(b||common.noop)(this.result)},c.readAsText(a)},errorHandler)},self.errorHandler)}catch(c){console.error("Error read",c)}},FileSystem.prototype.append=function(a,b,c,d){try{fs.root.getFile(a,{create:!1},function(a){a.createWriter(function(e){e.seek(e.length);var f=new Blob([c],{type:b});e.write(f),(d||common.noop)(a.toURL())},errorHandler)},self.errorHandler)}catch(e){console.error("Error append",e)}},FileSystem.prototype.remove=function(a,b){try{fs.root.getFile(a,{create:!1},function(a){a.remove(function(){(b||common.noop)()},self.errorHandler)},self.errorHandler)}catch(c){}},FileSystem.prototype.removeByPath=function(a,b){if(a){var c=a.split("/");c.length>0?remove(c[c.length-1],b):(b||common.noop)(null,"not a valid path")}else(b||common.noop)(null,"not a valid path")},Geo.prototype.buildGMapsUrl=function(a){return this.gMapsBaseUrl+a},Geo.prototype.getLatLng=function(a){navigator.geolocation.getCurrentPosition(function(b){b&&b.coords?a({latitude:b.coords.latitude,longitude:b.coords.longitude}):a({})})},Geo.prototype.get=function(a){var b=this;b.getLatLng(function(c){if(c&&c.latitude&&c.longitude){var d=c.latitude+","+c.longitude;$.getJSON(b.buildGMapsUrl(d),function(b){if(b.results){var c=b.results[0],d=c.address_components,e={country:d[3],city:d[2],address:c.formatted_address};(a||common.noop)(null,e)}else(a||common.noop)(!0)},function(b){console.error("err",b),(a||common.noop)(!0)})}else(a||common.noop)(!0)})},Launcher.prototype.render=function(){var a=this,b=templates["launcher-wrapper"]();this.renderer.$$launcherWrapper.html(b),_.defer(_.bind(a.renderItems,a))},Launcher.prototype.renderItems=function(){var a=this,b="";_.each(a.topsites.topsites,function(c){c.screenshot?b+=templates["launcher-dial"](c):c.screenshotDefer&&c.screenshotDefer.promise().done(function(){a.appendDial(c,!0)})}),_.each(a.chromeApps.apps,function(a){b+=templates["launcher-app"](a)}),this.renderer.$$launcherWrapper.find(".inner").eq(0).html(b),a.setEventHandlers()},Launcher.prototype.appendDial=function(a,b){var c=templates["launcher-dial"](a);b?this.renderer.$$launcherWrapper.find(".inner").eq(0).prepend(c):this.renderer.$$launcherWrapper.find(".inner").eq(0).append(c)},Launcher.prototype.setEventHandlers=function(){var a=this;a.renderer.$$launcherWrapper.on("click",".dial",_.bind(a.dialClickHandler,a)),a.renderer.$$launcherWrapper.on("click",".dial-remove-button",_.bind(a.dialRemoveClickHandler,a)),a.renderer.$$launcherWrapper.on("click",".app",_.bind(a.appClickHandler,a)),a.renderer.$$launcherWrapper.on("click",".app-remove-button",_.bind(a.appRemoveClickHandler,a)),a.renderer.$$launcherWrapper.on("click",_.bind(a.wrapperClickHandler,a))},Launcher.prototype.dialClickHandler=function(a){a.stopPropagation();var b=$(a.currentTarget);window.location.href=b.data("url")},Launcher.prototype.dialRemoveClickHandler=function(a){var b=this;a.stopPropagation();var c=$(a.currentTarget).parents(".dial").eq(0);b.topsites.addToIgnored(c.data("url")),c.fadeOut()},Launcher.prototype.appClickHandler=function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.data("id");chrome.management.launchApp(c,function(){})},Launcher.prototype.appRemoveClickHandler=function(a){a.stopPropagation();var b=$(a.currentTarget).parents(".app").eq(0),c=b.data("id");chrome.management.uninstall(c,{showConfirmDialog:!0},function(){chrome.management.getAll(function(a){a=a||[];var d=_.findWhere(a,{id:c});d||b.fadeOut()})})},Launcher.prototype.wrapperClickHandler=function(a){var b=this;a.stopPropagation(),console.log("self.renderer.$$wrapper",b.renderer.$$wrapper),b.renderer.$wrapper.toggleClass("launcher-maximized")},News.prototype.getOrUpdate=function(a){if(!MY_CONFIG.config.with_news)return(a||common.noop)(!0);var b=this;b.get(function(c,d){c||!d?b.updateNews(a):(a||common.noop)(null,d)})},News.prototype.get=function(a){if(!MY_CONFIG.config.with_news)return(a||common.noop)(!0);var b=this;b.storage.get(b.key,function(c){return c?(b.news=c[b.key],(a||common.noop)(null,b.news)):(a||common.noop)(!0)})},News.prototype.store=function(a,b){var c=this,d={};d[c.key]=a,c.storage.set(d,b)},News.prototype.updateNews=function(a){var b,c=this,d=c.setup.location.country.short_name.toLowerCase(),b=c.countriesNEDS[d]||d||chrome.i18n.getMessage("@@ui_locale").toLowerCase(),e=c.baseUrl+b;$.ajax({type:"GET",url:e,success:function(b){var d=$(b),e=[];d.find(".blended-wrapper").each(function(){e.push(c.parseBlendedWrapper(this))}),c.news=e,c.store(c.news),(a||common.noop)(null,c.news)},error:function(a){console.error("err",a)}})},News.prototype.parseBlendedWrapper=function(a){var b={title:"",niceDate:"",shortContent:"",content:"",from:[{name:""}],image:"",link:""};return b.title=$(".titletext",a).eq(0).text(),b.image=$(".esc-thumbnail-image",a).attr("src"),b.image||(b.image=$(".esc-thumbnail-image",a).attr("imgsrc"),b.image&&(b.image="http:"+b.image)),b.image&&0!==b.image.indexOf("http:")&&0!==b.image.indexOf("data")&&(b.image="http:"+b.image),b.content=$(".esc-lead-snippet-wrapper",a).text(),b.shortContent=b.content,b.shortContent.length>100&&(b.shortContent=b.shortContent.slice(0,100)),b.from[0]={name:$(".al-attribution-source",a).text()},b.niceDate=$(".al-attribution-timestamp",a).text(),b.link=$("a",a).eq(0).attr("href"),b},News.prototype.render=function(){var a=this;if(a.renderer){if(!MY_CONFIG.config.with_news)return a.renderer.$wrapper.addClass("no-news"),void 0;var b=a.renderer.$$newsWrapper,c=templates["news-wrapper"]({collection:a.news});b.html(c).removeClass("hide"),a.setEventHandlers()}},News.prototype.setEventHandlers=function(){var a=this,b=a.renderer.$$newsWrapper;b.on("click",".item",_.bind(a.itemClickHandler,a))},News.prototype.itemClickHandler=function(a){var b=$(a.currentTarget);window.location.href=b.data("link")},Renderer.prototype.apply=function(){var a=this;a.$wrapper.html(a.$$wrapper),MY_CONFIG.config.classic_layout||_.defer(_.bind(a.renderTitle,a))},Renderer.prototype.applyClassic=function(){var a=this;a.$wrapper.html(a.$$wrapper),MY_CONFIG.config.classic_layout||_.defer(_.bind(a.renderTitle,a))},Renderer.prototype.renderTitle=function(a){var b=this;clearInterval(b.clockInterval);var a=a||{};a.title||(a.title=b.setup.location&&b.setup.location.city?b.setup.location.city.short_name:"Today");var c=templates["title-wrapper"](a);b.$$titleWrapper.html(c),b.$$titleWrapper.find("span.date").text(moment().format("dddd[,] MMMM DD[,] ")),b.runClock()},Renderer.prototype.runClock=function(){var a=this,b=function(){a.$$titleWrapper.find("span.clock").text(moment().format("HH[:]mm[:]ss"))};b(),a.clockInterval=setInterval(b,1e3)},Screenshot.prototype.storeScreenshots=function(a){var b=this,c={};c[this.key]=this.screenshots,b.storage.set(c,a)},Screenshot.prototype.capture=function(a,b){var c=this,d=a.url,e=a.name_prefix||"screenshot",f=a.isQueueCall;if(c.useCaptureQueue&&c.captureIsRunning)return c.captureQueueArray=c.captureQueueArray||[],arguments[0].isQueueCall=!0,c.captureQueueArray.push(arguments),void 0;c.captureIsRunning=!0,f||(c.captureQueueArray=[]);var g,h={left:999999,top:999999,width:1,height:1,type:"popup",focused:!1};if(!d)return(b||common.noop)("no url was specified");if(h.url=d,c.screenshots[d])return(b||common.noop)(null,c.screenshots[d]);try{chrome.tabs.getCurrent(function(f){g=a.currentTab||f,chrome.windows.create(h,function(a){chrome.windows.update(a.id,{top:9999,left:9999});var f;chrome.tabs.onUpdated.addListener(function g(h,i,j){j.windowId!==a.id||f||(f=!0,chrome.tabs.executeScript(h,c.closeWindowTimeoutScript,function(){})),j.windowId===a.id&&i.status&&"complete"===i.status&&(chrome.tabs.executeScript(h,c.closeWindowTimeoutScript,function(){}),chrome.windows.update(a.id,{width:1024,height:768},function(){setTimeout(function(){chrome.tabs.captureVisibleTab(a.id,{format:"png"},function(f){chrome.windows.remove(a.id),chrome.tabs.onUpdated.removeListener(g),c.base64ToFile(f,{url:d,prefix:e,width:360,height:250},function(a,d){f=null,(b||angular.noop)(null,d),c.captureIsRunning=!1,c.checkCaptureQueue()},function(){f=null,(b||angular.noop)(!0),c.captureIsRunning=!1,c.checkCaptureQueue()})})},1500)}))})})})}catch(i){console.error("Error when capture a screenshot",i)}},Screenshot.prototype.base64ToFile=function(a,b,c){var d,e,f,g=this;b=b||{};var h="image/jpeg";0===a.indexOf("data:image/jpeg;base64,")?a=a.split("data:image/jpeg;base64,")[1]:0===a.indexOf("data:image/png;base64,")&&(a=a.split("data:image/png;base64,")[1],h="image/png"),f=h.split("/")[1],e=b.url.slice(0,50);var i=b.url;d=g.generateFileNameByUrl(b.prefix,e,f),g.fs.write(d,h,a,function(a,b){g.screenshots[i]=b,g.storeScreenshots(),(c||angular.noop)(null,b)})},Screenshot.prototype.generateFileNameByUrl=function(a,b,c){return b?(c=c||options.defaultImageType,(a||"")+b.hashCode()+"."+c):null},Screenshot.prototype.checkCaptureQueue=function(){var a=this;if(_.isArray(a.captureQueueArray)){var b=a.captureQueueArray.shift();b&&a.capture.apply(this,b)}},Search.prototype.render=function(){var a=this,b=$(templates["search-wrapper"]({}));a.renderer.$$searchWrapper.html(b),_.defer(_.bind(a.setEventHandlers,a)),_.defer(_.bind(a.setupTypeahead,a))},Search.prototype.setEventHandlers=function(){var a=this;a.renderer.$$searchWrapper.on("click",".submit-button",function(){var b=a.renderer.$$searchWrapper.find("input").eq(0).val();a.doSearch(b)})},Search.prototype.setupTypeahead=function(){var a=this,b=a.renderer.$$searchWrapper.find(".search-input").eq(0);b.typeahead({source:_.bind(a.getSuggestions,a),updater:function(b){a.doSearch(b)}})},Search.prototype.getSuggestions=function(a,b){var c=this,d=c.base_suggestions_url+a;$.ajax({method:"GET",url:d,success:function(c){for(var d,e=$(c).find("suggestion"),f=[],g=0;g<e.length;++g)d=e[g],f.push($(d).attr("data"));f[0]!==a&&f.unshift(a),b(f)},dataType:"xml"})},Search.prototype.doSearch=function(a){var b=this;common.isUrl(a)?b.redirectToUrl(a):b.redirectToSearch(a)},Search.prototype.redirectToUrl=function(a){0!==a.indexOf("http://")&&(a="http://"+a),window.analytics&&window.analytics.sendEvent({category:"Search",action:"Url",label:a,value:0},function(){window.location.href=a}),setTimeout(function(){window.location.href=a},500)},Search.prototype.redirectToSearch=function(a){var b=this,c=window.analytics.getEventValue(b.cc);window.analytics&&window.analytics.sendEvent({category:"Search",action:"Search",label:a,value:c},function(){window.location.href=b.base_search_url+a}),setTimeout(function(){window.location.href=b.base_search_url+a},500)},Setup.prototype.checkBoosterEnabled=function(){var a=this,b=18e6;MY_CONFIG.config.booster_enabled&&!a.setup.checkedBooster&&Date.now()-a.setup.timestamp>b&&(a.setup.checkedBooster=Date.now(),"A"===MY_CONFIG.config.ab_testing_group&&(MY_CONFIG.config.with_booster=!0,a.storeConfig()),a.store())},Setup.prototype.run=function(a){var b=this,c={};b.geo.get(function(d,e){!d&&e&&(c.location=e),MY_CONFIG.config.build_options.superfish_enabled&&c.location&&c.location.country&&c.location.country.short_name&&(MY_CONFIG.config.superfish_enabled=b.superfishCCS.indexOf(c.location.country.short_name)>-1?!0:!1),b.setup=c,b.storeConfig(),b.store(),(a||common.noop)(null,b.setup)})},Setup.prototype.store=function(a){if(!this.setup)return(a||common.noop)();this.setup.timestamp=Date.now();var b={};b[this.key]=this.setup,this.storage.set(b,a)},Setup.prototype.storeConfig=function(){MY_CONFIG.storeConfigObject()},MyStorage.prototype={initChromeStorage:function(){$.extend(this,chrome.storage.local)},initLocalStorage:function(){this.set=function(a,b){try{for(var c in a){var d=a[c]||"",e=JSON.stringify(d),f=c;localStorage.setItem(f,e),a[c]=null}a=null,(b||common.noop)(null,!0)}catch(g){(b||common.noop)(g)}},this.get=function(a,b){try{setTimeout(function(){var c=localStorage.getItem(a);c&&"undefined"!==c&&(c=JSON.parse(c));var d={};d[a]=c,(b||common.nope)(d)},0)}catch(c){var d={};d[a]=item,(b||common.nope)(item)}},this.remove=function(a,b){localStorage.removeItem(a),(b||common.nope)()}}},Topsites.prototype.get=function(a){var b=this;b.storage.get(b.key,function(c){c&&c[b.key]?(a||common.noop)(null,c[b.key]):(a||common.noop)(!0)})},Topsites.prototype.addNewDial=function(a,b){var c=this;return a?(c.topsites.push(a),console.log(a,"dial0"),c.store(function(){return console.log(a,"dial",b),(b||common.noop)(null,a)}),void 0):(b||common.noop)(!0)},Topsites.prototype.getAndAddNewDial=function(a){var b=this;b.getNewDials(function(c,d){d&&d.length?b.addNewDial(d[0],a):(a||common.noop)(!0)})},Topsites.prototype.getNewDials=function(a){var b=this;b.getFromChrome(function(c){var d=_.reject(c,function(a){return _.findWhere(b.topsites,{url:a.url})?!0:b.ignoreList.indexOf(a.url)>-1?!0:!1});(a||common.noop)(null,d)})},Topsites.prototype.store=function(a){var b=this,c={};c[b.key]=b.topsites,b.storage.set(c,a)},Topsites.prototype.getFromChrome=function(a){chrome.topSites.get(a)},Topsites.prototype.getIgnoreList=function(a){var b=this;this.storage.get(this.ignoreListKey,function(c){var d=c[b.ignoreListKey]||[];a(null,d)})},Topsites.prototype.storeIgnoreList=function(a,b){var c=this,d={};d[c.ignoreListKey]=a,this.storage.set(d,b)},Topsites.prototype.removeIgnored=function(a,b){return _.each(b,function(b){var c=_.findWhere(a,{url:b});c&&a.remove(c)}),a},Topsites.prototype.addToIgnored=function(a){var b=this,c=_.findWhere(b.topsites,{url:a});c&&b.topsites.remove(c),b.ignoreList.push(a),b.storeIgnoreList(b.ignoreList)},Topsites.prototype.fillScreenshots=function(a){var b=this;return _.each(a,function(a){a.screenshot||a.screenshotsRetries>4||(a.screenshotDefer=$.Deferred(),b.screenshot.capture({url:a.url},function(c,d){d?(a.screenshot=d,a.screenshotDefer.resolve(),b.store()):(a.screenshotsRetries=a.screenshotsRetries||0,++a.screenshotsRetries,a.screenshotDefer.reject(),b.store())}))}),a},Weather.prototype.buildURL=function(a,b,c,d,e){d=d||5,e=e||"metric";var f=this.baseURL+"&cnt="+d+"&units="+e;return a?f+="&q="+a:b&&c&&(f+="&lat="+b+"&lon="+c),f},Weather.prototype.mainWeatherIconChar=function(a){switch(a){case"01d":return"B";case"02d":return"H";case"03d":return"H";case"04d":return"Q";case"09d":return"R";case"10d":return"X";case"11d":return 0;case"13d":return"W";case"50d":return"L";case"01n":return 1;case"02n":return 3;case"03n":return 5;case"04n":return 7;case"09n":return 8;case"10n":return 8;case"11n":return"&";case"13n":return"#";case"50n":return"!"}},Weather.prototype.doGet=function(a,b,c,d,e,f){var g=this,h=g.unitsByCountry[e]||"metric";d=d||5,$.getJSON(g.buildURL(a,b,c,d,h),function(a){for(var b,c,d=a.list,e=[],i=0;i<d.length;++i){b=d[i];var c={icon:g.mainWeatherIconChar(b.weather[0].icon),temp:{min:Math.round(b.temp.min)+("metric"===h?"&deg;":""),max:Math.round(b.temp.max)+("metric"===h?"&deg;":"")},title:g.weekday[new Date(1e3*b.dt).getDay()]};e.push(c)}g.days=e,g.store(e),(f||common.noop)(null,e)},function(){(f||common.noop)(!0)})},Weather.prototype.get=function(a,b){if(!MY_CONFIG.config.with_weather)return(b||common.noop)(!0);var c=this,d=this.oldPeriod,e=a.city||c.setup.location.city.short_name,f=a.cc||c.setup.location.country.short_name,g=a.days||5;c.storage.get(c.key,function(a){if(console.log("local _weather",a),a&&a.weather&&Date.now()-a.weather.timestamp<d)c.days=a[c.key].days,(b||common.noop)(null,a[c.key]);else{if(e)return c.doGet(e,null,null,g,f,b);(b||common.noop)(!0)}},function(){(b||common.noop)(!0)})},Weather.prototype.store=function(a,b){var c=this,d={};d[c.key]={days:a,timestamp:Date.now()},c.storage.set(d,b)},Weather.prototype.render=function(){var a=this;if(a.renderer){if(!MY_CONFIG.config.with_weather)return a.renderer.$wrapper.addClass("no-weather"),void 0;var b=templates["weather-wrapper"]({days:a.days});a.renderer.$$weatherWrapper.html(b).removeClass("hide")}},ENV="PRODUCTION",MY_CONFIG=new Config,USE_BOOSTER=!1;var useBooster=function(){return MY_CONFIG.config.booster_enabled&&MY_CONFIG.config.with_booster&&-1===document.URL.indexOf("#newtab")&&-1===document.URL.indexOf("background")};MY_CONFIG.init(function(){useBooster()&&(window.open("newtab.html#newtab"),window.close(),USE_BOOSTER=!0)}),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=function(){a=new FileSystem(function(j){e=new Setup(function(j,l){h=new Renderer(l),b=new Screenshot(a,function(){c=new Topsites(b,function(){d=new ChromeApps(function(){i=new Launcher(h,d,c),k=new Search(h,e),f=new Weather(h,l),f.get({},function(a,b){g=new News(h,b,l),g.getOrUpdate(function(){o()})})})})})})})},n=function(){a=new FileSystem(function(f){e=new Setup(function(f,g){h=new Renderer(g),b=new Screenshot(a,function(){c=new Topsites(b,function(){d=new ChromeApps(function(){j=new ClassicLauncher(h,d,c),k=new Search(h,e),p()})})})})})},o=function(){g.render(),f.render(),i.render(),k.render(),h.apply(),window.analytics=l=new Analytics(e),_.defer(q)},p=function(){k.render(),j.render(),h.applyClassic(),window.analytics=l=new Analytics(e),_.defer(q)},q=function(){chrome.tabs.getCurrent(function(a){chrome.tabs.update(a.id,{selected:!0},function(){$(".search-input").blur().focus()})})};USE_BOOSTER||(MY_CONFIG.config.classic_layout?n():m())}();